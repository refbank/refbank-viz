---
title: "RefBank Visualization"
author: "Zihan Wang"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Let's take a look at chat.csv

```{r chat setup}
chat_csv <- read.csv("C:\\Users\\zihan\\Downloads\\multiparty-tangrams-main\\data\\study1\\chat.csv")
```

```{r logistics}
print(names(chat_csv))
print(nrow(chat_csv))
length(unique(chat_csv$gameId))
```
```{r}
library(dplyr)

rep_df <- chat_csv %>%
  group_by(gameId, repNum) %>%
  summarise(total_num_words = sum(total_num_words, na.rm = TRUE), .groups = "drop")



trial_df <- chat_csv %>%
  group_by(gameId, trialNum) %>%
  summarise(total_num_words = sum(total_num_words, na.rm = TRUE), .groups = "drop")


```


Let's analyze data from each game

```{r}
library(ggplot2)
ggplot(chat_csv, aes(x = gameId, y = total_num_words, fill = repNum)) +
  geom_bar(stat = "identity") +
  labs(title = "Sum of Words Per Game", x = "gameId", y = "Total Number of Words") +
  theme_minimal()
```

```{r}
chat_csv

```

```{r}
```


```{r}
ggplot(rep_df, aes(x = repNum, y = total_num_words, color = as.factor(gameId), group = gameId)) +
  geom_line() +
  geom_point() +
  geom_smooth(aes(group = 1), method = "lm", se = TRUE, color = "black", linetype = "dashed") +  # Regression line
  labs(title = "Total Number of Words Per Repetition", x = "Repetition Number", y = "Total Number of Words", color = NULL) +
  theme_minimal() +
  theme(legend.position = "none")  # Hide legend but keep colors distinct
```


```{r}
ggplot(trial_df, aes(x = trialNum, y = total_num_words, color = as.factor(gameId), group = gameId)) +
  geom_line() +
  geom_point() +
  geom_smooth(aes(group = 1), method = "lm", se = TRUE, color = "black", linetype = "dashed") +  # Regression line
  labs(title = "Total Number of Words Per Trial", x = "Trial Number", y = "Total Number of Words", color = NULL) +
  theme_minimal() +
  theme(legend.position = "none")  # Hide legend but keep colors distinct
```
```{r}
library(ggplot2)
library(ggpubr)  # For adding regression line with confidence intervals

# Assuming new_df is your dataframe with columns: repNum, total_num_words, gameId

# Create the plot
ggplot(chat_csv, aes(x = repNum, y = total_num_words, color = as.factor(gameId), group = gameId)) +
  geom_line() +  # Line connecting points for each game
  geom_point() +  # Individual data points
  geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +  # Regression line with confidence interval
  labs(
    title = "Total Number of Words Per Trial", 
    x = "Repetition Number", 
    y = "Total Number of Words", 
    color = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "none") 
```


```{r}
# Filter rows where 'submitted' and 'correct' are both TRUE and not NA
filtered_data <- chat_csv[!is.na(chat_csv$submitted) & !is.na(chat_csv$correct) &
                          chat_csv$submitted == TRUE & chat_csv$correct == TRUE, ]

# Count rows by 'gameId' and 'repNum', and calculate accuracy
accuracy_data <- aggregate(submitted ~ gameId + repNum, data = filtered_data, FUN = length)

# Merge with total count of rows for each 'gameId' and 'repNum' to calculate accuracy
total_data <- aggregate(submitted ~ gameId + repNum, data = chat_csv, FUN = length)

# Merge both datasets to calculate accuracy
accuracy_data <- merge(accuracy_data, total_data, by = c("gameId", "repNum"), suffixes = c("_correct", "_total"))

# Calculate accuracy as a proportion
accuracy_data$accuracy <- accuracy_data$submitted_correct / accuracy_data$submitted_total

print(accuracy_data)
```

```{r}
# Average accuracy for each 'repNum'
avg_accuracy <- aggregate(accuracy ~ repNum, data = accuracy_data, FUN = mean)

print(avg_accuracy)
ggplot(avg_accuracy, aes(x = factor(repNum), y = accuracy, fill = factor(repNum))) +
  geom_bar(stat = "identity") +
  labs(x = "Rep Num", y = "Average Accuracy", fill = "Rep Num", title = "Average Accuracy by RepNum") +
  theme_minimal()
```

```{r}
reaction_time <- chat_csv[!is.na(chat_csv$time),]
avg_time <- aggregate(time ~ repNum, data = reaction_time, FUN = mean)
ggplot(avg_time, aes(x = factor(repNum), y = time, fill = factor(repNum))) +
  geom_bar(stat = "identity") +
  labs(x = "Rep Num", y = "Average Time", fill = "Rep Num", title = "Average Time by RepNum") +
  theme_minimal()
```
```{r}
library(readr)
addr <- "C:\\Users\\zihan\\Downloads\\tangrams_harmonized.csv.zip"
csv_file_name <- "tangrams_harmonized.csv"

harmonized_csv <- read_csv(unz(addr, csv_file_name), show_col_types = FALSE)
head(harmonized_csv,10)

```







## Test out R shiny

```{r pressure, echo=FALSE}
install.packages("shiny")
library(shiny)
runExample("01_hello")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
