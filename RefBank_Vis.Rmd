---
title: "RefBank Visualization"
author: "Zihan Wang"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Let's take a look at chat.csv

```{r chat setup}
chat_csv <- read.csv("C:\\Users\\zihan\\Downloads\\multiparty-tangrams-main\\data\\study1\\chat.csv")
```

```{r logistics}
print(names(chat_csv))
print(nrow(chat_csv))
length(unique(chat_csv$gameId))
```
Let's analyze data from each game

```{r}
library(ggplot2)
ggplot(chat_csv, aes(x = gameId, y = total_num_words, fill = repNum)) +
  geom_bar(stat = "identity") +
  labs(title = "Sum of Words Per Game", x = "gameId", y = "Total Number of Words") +
  theme_minimal()
```
```{r}
# Filter rows where 'submitted' and 'correct' are both TRUE and not NA
filtered_data <- chat_csv[!is.na(chat_csv$submitted) & !is.na(chat_csv$correct) &
                          chat_csv$submitted == TRUE & chat_csv$correct == TRUE, ]

# Count rows by 'gameId' and 'repNum', and calculate accuracy
accuracy_data <- aggregate(submitted ~ gameId + repNum, data = filtered_data, FUN = length)

# Merge with total count of rows for each 'gameId' and 'repNum' to calculate accuracy
total_data <- aggregate(submitted ~ gameId + repNum, data = chat_csv, FUN = length)

# Merge both datasets to calculate accuracy
accuracy_data <- merge(accuracy_data, total_data, by = c("gameId", "repNum"), suffixes = c("_correct", "_total"))

# Calculate accuracy as a proportion
accuracy_data$accuracy <- accuracy_data$submitted_correct / accuracy_data$submitted_total

print(accuracy_data)
```

```{r}
# Average accuracy for each 'repNum'
avg_accuracy <- aggregate(accuracy ~ repNum, data = accuracy_data, FUN = mean)

print(avg_accuracy)
ggplot(avg_accuracy, aes(x = factor(repNum), y = accuracy, fill = factor(repNum))) +
  geom_bar(stat = "identity") +
  labs(x = "Rep Num", y = "Average Accuracy", fill = "Rep Num", title = "Average Accuracy by RepNum") +
  theme_minimal()
```
```{r}
reaction_time <- chat_csv[!is.na(chat_csv$time),]
avg_time <- aggregate(time ~ repNum, data = reaction_time, FUN = mean)
ggplot(avg_time, aes(x = factor(repNum), y = time, fill = factor(repNum))) +
  geom_bar(stat = "identity") +
  labs(x = "Rep Num", y = "Average Time", fill = "Rep Num", title = "Average Time by RepNum") +
  theme_minimal()
```

## Test out R shiny

```{r pressure, echo=FALSE}
install.packages("shiny")
library(shiny)
runExample("01_hello")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
